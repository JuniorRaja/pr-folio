// Seed script to populate Vectorize with portfolio data

// Note: In production Worker environment, you may need to serve bio content differently
// For local development, we'll include the content directly
const BIO_CONTENT = `# Bio Data for Prasanna Rajendran's Portfolio RAG Chatbot

## About Me

Hi, I'm Prasanna, versatile & dynamic CS enthusiast based in Chennai, India. With expertise in leading teams, web development, design, and photography, I blend technology and creativity to craft engaging and industry standard digital experiences. As a full-stack developer and passionate traveler, I bring a unique perspective to every project. I'm a passionate developer and project manager who loves creating beautiful digital experiences and capturing the world through photography. I have over 6 years of professional experience in the FinTech industry, specializing in financial software solutions.

## Travel

As a passionate traveler, I have had the opportunity to visit several countries and experience diverse cultures. Some of the places I've explored include:

- Australia - Discovering the unique landscape and wildlife
- Czech Republic - Immersing in European history and architecture
- Hungary - Experiencing central European culture and cuisine
- Poland - Exploring historical sites and vibrant cities
- Singapore - Visiting modern architecture and cultural diversity
- Slovenia - Enjoying natural beauty and alpine adventures
- Slovakia - Discovering castles and mountainous regions

These experiences have helped broaden my perspective and inspire my creativity in both life and work.

## Skills

### Technical Skills

#### Frontend & Mobile
- React (Expert level) - Advanced component development, hooks, state management
- TypeScript (Expert level) - Type-safe development, interfaces, generics
- JavaScript (Expert level) - ES6+, async/await, modern JS features
- HTML5 (Expert level) - Semantic HTML, accessibility
- CSS3 (Expert level) - Advanced styling, animations, layouts
- Tailwind CSS (Expert level) - Utility-first CSS framework
- Next.js (Intermediate level) - Server-side rendering, App Router
- jQuery (Intermediate level) - DOM manipulation, AJAX
- Vue.js (Beginner level) - Component-based development
- Redux (Beginner level) - State management
- Zustand (Beginner level) - Lightweight state management
- Axios (Beginner level) - HTTP client for API calls
- React Native (Beginner level) - Mobile app development
- Zod (Beginner level) - Schema validation

#### Backend & APIs
- C# (Expert level) - Object-oriented programming, LINQ
- .NET Core / .NET 8 (Expert level) - Enterprise application development
- ASP.NET (Expert level) - Web API development, MVC
- Node.js (Intermediate level) - Server-side JavaScript
- Express JS (Beginner level) - Web framework for Node.js
- Python (Intermediate level) - Scripting, automation
- GraphQL (Intermediate level) - Query language for APIs
- OAuth2 (Expert level) - Authentication and authorization
- YARP (Intermediate level) - Reverse proxy
- SignalR (Beginner level) - Real-time communication
- Ocelot API Gateway (Beginner level) - Microservices gateway
- IIS (Beginner level) - Web server management

#### Database & Storage
- MSSQL (Expert level) - Complex queries, stored procedures
- PostgreSQL (Intermediate level) - Relational database management
- MySQL (Intermediate level) - Database design and optimization
- MongoDB (Intermediate level) - NoSQL document database
- Redis (Intermediate level) - Caching and session storage
- Blob Storage (Expert level) - Azure cloud storage
- Amazon S3 (Intermediate level) - AWS object storage
- CosmosDB (Beginner level) - Globally distributed NoSQL database

#### DevOps & Cloud
- Azure (Expert level) - Cloud infrastructure, PaaS, IaaS
- AWS (Intermediate level) - Cloud services, EC2, S3
- GCP (Beginner level) - Cloud platform basics
- Docker (Intermediate level) - Containerization
- Jenkins (Intermediate level) - CI/CD pipelines
- GitHub (Expert level) - Version control, collaboration
- SonarQube (Intermediate level) - Code quality analysis

#### Testing & Tools
- xUnit (Expert level) - Unit testing framework
- NUnit (Expert level) - .NET testing
- Jest (Intermediate level) - JavaScript testing
- Figma (Intermediate level) - UI/UX design
- Photoshop (Intermediate level) - Graphic design
- Vite (Intermediate level) - Build tool and dev server
- NPM (Expert level) - Package management

### Soft Skills and Interests
- Project Management - Leading development teams
- Team Training and Mentoring - Junior developer coaching
- Web Development - Full-stack development
- UI/UX Design - User interface design
- Photography - Creative visual storytelling
- Travel - Exploring new destinations
- Leadership - Team management and coordination
- Psychology - Understanding human behavior
- Cooking - Culinary creativity
- Reading - Personal development books
- Music - Appreciation and creative expression

### Currently Learning
- Kubernetes - Container orchestration
- Ruby on Rails - Full-stack web framework
- Go - Systems programming language
- Rust - Memory-safe programming
- Machine Learning - AI and data science
- AI Integration - API integrations with AI services
- Kafka - Event streaming platform

## Projects

### PR Verse (Personal Portfolio Website)
My main portfolio website showcasing projects, skills, and professional journey. Built with cutting-edge web technologies including Next.js, Tailwind CSS, Three.js, and Framer Motion. Features a modern, interactive design with 3D elements and smooth animations.

**Tech Stack:** Next.js, Tailwind CSS, Three.js, Framer Motion, TypeScript, JavaScript
**Key Features:** 3D globe visualization, responsive design, dark/light themes, project galleries, photography portfolio, book recommendations, travel logs, contact forms
**Live URL:** https://prasannar.com/
**GitHub:** https://github.com/JuniorRaja/pr-folio

### PR Digital Resume
An interactive digital resume as an alternative to traditional PDF resumes. Built with pure HTML, CSS, and JavaScript featuring responsive design and modern web interactions.

**Tech Stack:** HTML5, CSS3, JavaScript, Responsive Design
**Key Features:** Interactive sections, responsive layout, modern typography, printable design
**Live URL:** https://juniorraja.github.io/pr-digital-resume/
**GitHub:** https://github.com/JuniorRaja/pr-digital-resume

### Brainwave AI Chat App
A modern AI chat application with an intuitive interface. Built with React and Vite for performance optimization, featuring hero sections, feature showcases, and pricing plans.

**Tech Stack:** React, Tailwind CSS, JavaScript, Vite
**Key Features:** Responsive UI, modern animations, chat interface design, pricing showcase
**Live URL:** https://chataibrainwave.netlify.app
**GitHub:** https://github.com/JuniorRaja/Brainwave-ReactJS

### FinDashboard
A comprehensive financial dashboard featuring transactional data visualization, charts, and analytics. Displays financial information with responsive design and interactive elements.

**Tech Stack:** HTML5, CSS3, JavaScript, Data Visualization
**Key Features:** Transaction tracking, data charts, responsive layout, light/dark mode toggle, financial analytics
**Live URL:** https://findashboardbypr.netlify.app/
**GitHub:** https://github.com/JuniorRaja/FinDashboard

### Metaverse Landing Page
A visually stunning landing page for a metaverse platform featuring immersive animations and modern UI design. Built with Next.js 13, Tailwind CSS, and Framer Motion.

**Tech Stack:** Next.js 13, Tailwind CSS, Framer Motion, JavaScript
**Key Features:** Server-side rendering, advanced animations, pricing plans, feature showcases, world exploration sections
**Live URL:** https://prmetaversesite.netlify.app/
**GitHub:** https://github.com/JuniorRaja/MetaverseLandingPage_reactJS

### Bank App Landing Page
A modern banking application landing page built with ReactJS, featuring responsive design and modern UI components. Inspired by professional tutorials showcasing financial app frontend development.

**Tech Stack:** React, Tailwind CSS, JavaScript, Vite
**Key Features:** Service offerings display, testimonials, call-to-action elements, responsive design, modern banking UI
**Live URL:** https://hoobank-web.netlify.app
**GitHub:** https://github.com/JuniorRaja/bankApp_reactJS

## Experience

### Deputy Project Manager - Development (April 2024 - Present)
Leading a software development team in a FinTech company specializing in core Non-Banking Financial Solution products. Responsibilities include:

- Full Software Development Lifecycle (SDLC) management from requirement analysis to maintenance
- Technical documentation including functional specifications and technical designs
- Code development, unit testing, and quality assurance
- Team leadership and project coordination
- Process improvement and technical strategy

### Assistant Project Manager - Development (October 2022 - March 2024)
Project leadership role focusing on team development and technical oversight:

- Training and mentoring junior associates on business processes and coding standards
- Task assignment and performance monitoring
- Knowledge transfer on development methodologies
- Quality control and code review processes
- Cross-functional team coordination

### Software Engineer Trainee (June 2019 - September 2022)
Entry-level development position focusing on learning and contribution:

- Computer Science fundamentals and communication skills development
- Test-Driven Development practices
- .NET Core technology stack training
- Code development and debugging
- Quality assurance and testing procedures
- Professional development and skill enhancement

### Overall Professional Experience
- Industry: FinTech / Non-Banking Financial Services
- Company: FinTech firm in Chennai, India
- Started: April 2019 (over 6.5 years experience)
- Current Role: Leading development team for core financial products
- Key Achievements: Progressed from trainee to leadership position, trained multiple junior developers, contributed to multiple fintech solutions

## Education

- **Bachelor's Degree in Computer Science**
- Location: Chennai, India
- Focus Areas: Computer Science fundamentals, programming, software engineering principles
- Additional Learning: Continuous professional development through books, online courses, and industry certifications

## Contact

- **Email:** imprasannarajendran@gmail.com
- **LinkedIn:** https://www.linkedin.com/in/rajendranprasanna/
- **Instagram:** https://www.instagram.com/prasanna.it.seems/
- **Location:** Chennai, Tamil Nadu, India
- **Phone:** Available through contact form or direct message
- **Portfolio Website:** https://prasannar.com/
- **GitHub:** https://github.com/JuniorRaja
`;

/**
 * Splits text into chunks of approximately 300-500 tokens with overlap
 * Ensures chunks don't break mid-sentence and have meaningful content
 */
function chunkText(text, chunkSize = 400, overlap = 2) {
  // Split by sections first to maintain topic coherence
  const sections = text.split(/^##\s+/m);
  const chunks = [];

  for (const section of sections) {
    if (!section.trim()) continue;

    const lines = section.split('\n').filter(line => line.trim());
    if (lines.length === 0) continue;

    // Get section title from first line
    let sectionTitle = '';
    let startIndex = 0;
    sectionTitle = lines[0].toLowerCase();
    startIndex = 1;

    const content = lines.slice(startIndex).join('\n');

    // Split content into sentences
    const sentences = content.split(/[.!?]\s+/).filter(s => s.trim().length > 0);

    let chunk = '';
    let sentenceStart = 0;

    for (let i = 0; i < sentences.length; i++) {
      const currentChunk = chunk + (chunk ? ' ' : '') + sentences[i];

      // Count approximate tokens (rough estimate: 1 word ≈ 1.3 tokens)
      const approxTokens = currentChunk.split(/\s+/).length * 1.3;

      if (approxTokens >= chunkSize && currentChunk.length > 100) {
        // Create chunk
        chunks.push({
          text: currentChunk.trim(),
          section: sectionTitle || 'general',
          startSentence: sentenceStart,
          endSentence: i
        });

        // Start next chunk with overlap
        const overlapStart = Math.max(0, i - overlap + 1);
        chunk = sentences.slice(overlapStart, i + 1).join('. ') + '.';
        sentenceStart = overlapStart;
      }
    }

    // Add remaining content as final chunk if substantial enough
    if (chunk.length > 50) {
      chunks.push({
        text: chunk.trim(),
        section: sectionTitle || 'general',
        startSentence: sentenceStart,
        endSentence: sentences.length - 1
      });
    }
  }

  return chunks.filter(chunk => chunk.text.length > 100); // Filter very small chunks
}

export default {
  async fetch(request, env) {
    // Only allow POST requests or run when called directly
    if (request && request.method !== 'POST') {
      return new Response('Method not allowed', { status: 405 });
    }

    try {
      console.log('Starting seed process...');

      // Use embedded bio data
      const bioContent = BIO_CONTENT;
      console.log(`Loaded bio content: ${bioContent.length} characters`);

      // Create chunks
      const chunks = chunkText(bioContent);
      console.log(`Created ${chunks.length} chunks`);

      // Process each chunk
      for (let i = 0; i < chunks.length; i++) {
        const chunk = chunks[i];
        const chunkId = crypto.randomUUID();

        console.log(`Processing chunk ${i + 1}/${chunks.length}: ${chunk.section} (${chunk.text.length} chars)`);

        try {
          // Generate embedding using Workers AI BGE model
          const embeddingResponse = await env.AI.run('@cf/baai/bge-base-en-v1.5', {
            text: [chunk.text]
          });

          const embedding = embeddingResponse.data[0];

          if (!embedding || embedding.length !== 768) {
            throw new Error(`Invalid embedding dimensions: expected 768, got ${embedding?.length || 'undefined'}`);
          }

          // Store in Vectorize
          await env.VECTORIZE.upsert([
            {
              id: chunkId,
              values: embedding,
              metadata: {
                text: chunk.text,
                section: chunk.section,
                chunkIndex: i,
                totalChunks: chunks.length,
                charCount: chunk.text.length,
                createdAt: new Date().toISOString()
              }
            }
          ]);

          console.log(`✓ Stored chunk ${i + 1} with ID: ${chunkId}`);

          // Small delay to avoid rate limiting
          await new Promise(resolve => setTimeout(resolve, 100));

        } catch (error) {
          console.error(`✗ Failed to process chunk ${i + 1}:`, error.message);
          // Continue with other chunks
        }
      }

      console.log(`Seeding completed. Total chunks processed: ${chunks.length}`);

      return new Response(JSON.stringify({
        success: true,
        chunksProcessed: chunks.length,
        sections: [...new Set(chunks.map(c => c.section))],
        message: 'Vectorize database seeded successfully'
      }), {
        headers: { 'Content-Type': 'application/json' }
      });

    } catch (error) {
      console.error('Seeding failed:', error);
      return new Response(JSON.stringify({
        success: false,
        error: error.message
      }), {
        status: 500,
        headers: { 'Content-Type': 'application/json' }
      });
    }
  }
};
